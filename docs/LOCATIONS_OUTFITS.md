# Locations & Outfits Management

## Overview

Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ð¾Ðµ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð»Ð¾ÐºÐ°Ñ†Ð¸ÑÐ¼Ð¸ Ð¸ Ð¾Ð±Ñ€Ð°Ð·Ð°Ð¼Ð¸ Ð´Ð»Ñ fashion-Ð±Ð»Ð¾Ð³ÐµÑ€Ð¾Ð². Ð›Ð¾ÐºÐ°Ñ†Ð¸Ð¸ Ð¸ Ð¾Ð±Ñ€Ð°Ð·Ñ‹ Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ð¾Ð´Ð¸Ð½ Ñ€Ð°Ð· Ð² Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ðµ Ð±Ð»Ð¾Ð³ÐµÑ€Ð°, Ð·Ð°Ñ‚ÐµÐ¼ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ ÐºÐ°Ðº Ð¿Ñ€ÐµÑÐµÑ‚Ñ‹ Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð·Ð°Ð´Ð°Ñ‡.

## Features

### Locations Manager
- **ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€**: Grid Ñ Ð¿Ñ€ÐµÐ²ÑŒÑŽ Ð²ÑÐµÑ… Ð»Ð¾ÐºÐ°Ñ†Ð¸Ð¹ (title + thumbnail)
- **Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ**: 
  - Upload mode: Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ„Ð¾Ñ‚Ð¾ + Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ
  - Generate mode: Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚ â†’ SDXL 4.0 â†’ Ð¿Ñ€ÐµÐ²ÑŒÑŽ â†’ Ð¿Ñ€Ð¸Ð½ÑÑ‚ÑŒ/Ð¿ÐµÑ€ÐµÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
- **Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ**: ÐšÐ½Ð¾Ð¿ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ñ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸ÐµÐ¼

### Outfits Manager
- **ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€**: Grid full-body outfit Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹
- **Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ**:
  - Composite mode: Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ñ‡Ð°ÑÑ‚ÐµÐ¹ (ðŸ‘• Ð²ÐµÑ€Ñ…, ðŸ‘– Ð½Ð¸Ð·, ðŸ‘Ÿ Ð¾Ð±ÑƒÐ²ÑŒ, ðŸ‘œ Ð°ÐºÑÐµÑÑÑƒÐ°Ñ€Ñ‹) â†’ SDXL ÑÐ¾Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ð² Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð·
  - ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾
- **Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ**: SDXL ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ full-height portrait Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð½Ñ‹Ñ… Ñ‡Ð°ÑÑ‚ÐµÐ¹
- **Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ**: ÐšÐ½Ð¾Ð¿ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ Ñ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸ÐµÐ¼

## API Endpoints

### Locations
```
POST   /api/bloggers/{id}/locations          # Add location
DELETE /api/bloggers/{id}/locations/{idx}    # Delete location
POST   /api/bloggers/{id}/locations/generate # Generate via SDXL
```

### Outfits
```
POST   /api/bloggers/{id}/outfits            # Add outfit
DELETE /api/bloggers/{id}/outfits/{idx}      # Delete outfit
POST   /api/bloggers/{id}/outfits/generate   # Generate composite outfit
```

## Database Schema

### Blogger Model
```python
locations = Column(JSON)  # [{title: str, description: str, thumbnail: str}]
outfits = Column(JSON)    # [{name: str, image_url: str, parts: {...}}]
```

## UI Components

### LocationsManager
**Location:** `frontend/app/bloggers/[id]/LocationsManager.tsx`

**Props:**
- `bloggerId: number`
- `locations: Location[]`
- `onUpdate: (locations: Location[]) => void`

### OutfitsManager
**Location:** `frontend/app/bloggers/[id]/OutfitsManager.tsx`

**Props:**
- `bloggerId: number`
- `outfits: Outfit[]`
- `onUpdate: (outfits: Outfit[]) => void`

### Integration
Both managers are integrated into **EditForm.tsx** and only shown for fashion bloggers (`type === "fashion"`).

## Workflow

1. **Setup Phase**: Edit blogger â†’ Add locations/outfits â†’ Save
2. **Task Creation Phase**: Create fashion task â†’ Select from existing locations/outfits (visual grid selector)
3. **Generation**: SDXL 4.0 generates frames using selected presets

## Migration

Run migration to add `outfits` field:
```bash
psql $DATABASE_URL -f backend/migrations/add_outfits_field.sql
```

## SDXL Integration

- **Locations**: 16:9 aspect ratio (landscape)
- **Outfits**: 3:4 aspect ratio (portrait, full body)
- Uses existing `generate_fashion_frame()` from `backend/utils/image_generation.py`
- API: FAL.ai FLUX Pro v1.1-ultra

## Notes

- Locations/outfits stored as JSON arrays in database
- Frontend manages state locally, saves on form submit
- Delete operations rebuild array without deleted index
- Generation workflow: prompt â†’ API call â†’ preview â†’ accept/regenerate
